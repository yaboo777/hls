<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>生放送視聴</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<button id="playButton">▶</button>
<p><span id="current"></span><input type="range" id="seekbar"><span id="duration"></span></p>
<ul id="debug"></ul>
<ul id="debug2"></ul>
<audio preload="auto" id="audio">
	<source type="audio/mpeg" src="http://qthttp.apple.com.edgesuite.net/1010qwoeiuryfg/sl.m3u8">
</audio>
<script src="jquery-2.1.1.js"></script>
<script>
$(function () {
	var $audio = $('#audio');
	var audio = $audio[0];
	var $button = $('#playButton');
	var $current = $('#current');
	var $duration = $('#duration');
	var $seekbar = $('#seekbar');
	var seekbar = $seekbar[0];
	var $debug = $('#debug');
	var $debug2 = $('#debug2');

	var convertTime = function (time) {
		if (Number.isFinite(time) || Number.isNaN(time)) {
			return '00:00:00';
		}
		time = parseInt(time, 10);
		var hour = parseInt(time / 3600, 10);
		var min = parseInt((time - 3600 * hour) / 60, 10);
		var sec = parseInt(time - 3600 * hour - 60 * min, 10);
		var strHour = hour < 10 ? '0' + hour : hour;
		var strMin = min < 10 ? '0' + min : min;
		var strSec = sec < 10 ? '0' + sec : sec;

		return strHour + ':' + strMin + ':' + strSec;
	};

	var setDuration = function () {
		var duration = audio.duration;
		$duration.text(convertTime(duration));
		$debug.append('<li>' + duration + '</li>');
		setTimeout(function () {
			setDuration();
		}, 1000);
	};

	Number.isFinite = Number.isFinite || function (any) {
		$debug2.append('<li>' + (typeof any) + '</li>');
		return typeof any === 'number' && isFinite(any);
	};

	Number.isNaN = Number.isNaN || function (any) {
		$debug2.append('<li>' + (typeof any) + '</li>');
		return typeof any === 'number' && isNaN(any);
	};

	$current.text('00:00:00');

	$button.on('click', function () {
		$button.text('■');
		if (audio.paused) {
			audio.play();
			$button.text('■');
		} else {
			audio.pause();
			$button.text('▶');
		}
	});
	
	$audio.on('loadedmetadata', function () {
//		var duration = audio.duration;
//		$button.removeAttr('disabled');
//		$duration.text(convertTime(duration));

		seekbar.disabled = false;
		seekbar.min = seekbar.value = audio.initialTime || 0;
		seekbar.max = duration;
	});

	$audio.on('timeupdate', function () {
		seekbar.value = audio.currentTime;
		$current.text(convertTime(audio.currentTime));
	});

	$seekbar.on('change', function () {
		audio.currentTime = this.valueAsNumber;
		$current.text(convertTime(this.valueAsNumber));
	});

	setTimeout(function () {
		setDuration();
	}, 1000);
});
</script>
</body>
</html>
